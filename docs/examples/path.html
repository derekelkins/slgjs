<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Transitive Closure Example</title>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.20.1/vis.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.20.1/vis.min.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.5/require.min.js"></script>
    <style type="text/css">
        .graphBox {
            width: 500px;
            height: 400px;
            margin-bottom: 2em;
        }
    </style>
</head>
<body>
<pre><code id="codeBox" class="js"></code></pre>
Input:
<div id="edgeGraph" class="graphBox"></div>
Output (shake it loose):
<div id="pathGraph" class="graphBox"></div>
Subgoal Dependency Graph:
<div id="sdgGraph" class="graphBox"></div>
<script id="code" type="text/javascript">
requirejs(['../out/slg'], function(slg) {
const nodes = new vis.DataSet([
     {id: 1, label: '1'}
    ,{id: 2, label: '2'}
    ,{id: 3, label: '3'}
    //,{id: 4, label: '4'}
]);

const edge = new slg.EdbPredicate([
    [1, 2],
    [2, 3],
    [3, 1]]);
    //[3, 4]]);
const path = new slg.TabledPredicate(([X, Z]) => slg.rule(
    () => [edge.match([X, Z])],
    Y  => [edge.match([X, Y]), path.match([Y, Z])]));

const edgeEdges = slg.toArrayQ(Q => slg.clause((S, E) => [edge.match([S, E]), slg.unify(Q, {from: S, to: E})]));
const [sdgEdges, pathEdges] = slg.debugToArrayQ(Q => slg.clause((S, E) => [path.match([S, E]), slg.unify(Q, {from: S, to: E})]));

const dedup = {};
for(const edge of sdgEdges) {
    dedup[edge[0]] = edge[0];
    dedup[edge[1]] = edge[1];
}

const sdgNodes = new vis.DataSet(Object.keys(dedup).map(k => ({id: dedup[k], label: k})));

const edgeData = {
    nodes: nodes,
    edges: new vis.DataSet(edgeEdges)
};
const pathData = {
    nodes: nodes,
    edges: new vis.DataSet(pathEdges)
};
const sdgData = {
    nodes: sdgNodes,
    edges: new vis.DataSet(sdgEdges.map(e => ({from: e[0], to: e[1]})))
};
const options = {edges: {arrows: 'to'}};
new vis.Network(document.getElementById('edgeGraph'), edgeData, options);
new vis.Network(document.getElementById('pathGraph'), pathData, options);
new vis.Network(document.getElementById('sdgGraph'), sdgData, options);
});
</script>
<script type="text/javascript">
document.getElementById('codeBox').innerHTML = document.getElementById('code').innerText;
hljs.initHighlightingOnLoad();
</script>
</body>
</html>
